// Generated by CoffeeScript 1.6.1
(function() {
  var Prlx;

  Prlx = (function() {
    var Actor, prefixed_properties, vendor_prefixes;

    Actor = (function() {

      function Actor(options, instance) {
        var _this = this;
        this.options = options;
        this.instance = instance;
        this.instance.el.on('test', function() {
          return _this.instance.queue.push(_this.options.partial_adjustment(_this.test()));
        });
      }

      Actor.prototype.test = function() {
        var adjustment, current_el_position, new_el_position, old_position;
        current_el_position = this.instance.positionOfElement();
        if (current_el_position !== old_position && this.instance.isElPartiallyVisible()) {
          new_el_position = Math.min(Math.pow(current_el_position, this.options.acceleration_rate), 1);
          adjustment = this.options.maximum_distance * new_el_position;
          console.log(this.options);
        }
        old_position = current_el_position;
        return adjustment;
      };

      return Actor;

    })();

    vendor_prefixes = ["-webkit-", "-moz-", "-ms-", "-o-"];

    prefixed_properties = ["border-radius", "transform", "perspective", "perspective-origin", "box-shadow", "background-size"];

    function Prlx(el, options, fn) {
      var args, number, property, val,
        _this = this;
      this.el = el;
      this.options = options;
      this.window = $(window);
      this.document = $(document);
      this.document_height = this.document.height();
      this.window_height = this.window.height();
      this.scroll_top = this.window.scrollTop();
      this.scroll_bottom = this.scroll_top + this.window_height;
      this.el_top = this.el.offset().top;
      this.el_height = this.el.height();
      this.running = false;
      this.queue = [];
      this.actors = [];
      for (property in options) {
        val = options[property];
        args = val.match(/\S+/g);
        number = args[0].match(/(\d+)([a-zA-Z]+)/i);
        console.log(number);
        this.actors.push(new Actor({
          el: this.el,
          property: property,
          maximum_distance: number[1],
          unit: number[2],
          acceleration_rate: args[1],
          trigger: args[2],
          partial_adjustment: this.computeAdjustment(property, number[2])
        }, this));
      }
      this.window.on('resize', function() {
        return _this.window_height = _this.window.height();
      });
      this.window.on('scroll', function(event) {
        _this.event = event;
        _this.scroll_top = _this.window.scrollTop();
        _this.scroll_bottom = _this.scroll_top + _this.window_height;
        _this.el.trigger('test');
        if (!_this.running) {
          requestAnimationFrame(function() {
            if (_this.queue.length) {
              _this.queue.pop();
            }
            return _this.running = false;
          });
        }
        return _this.running = true;
      });
    }

    Prlx.prototype.computeAdjustment = function(property, unit) {
      var _this = this;
      return function(adjustment) {
        if (prefixed_properties.indexOf(property) >= 0) {
          if (property === 'rotate' || property === 'skew' || property === 'rotate') {
            return _this.el.css({
              "transform": "" + property + "(" + adjustment + (unit(unit ? void 0 : 'px')) + ")",
              "-moz-transform": "" + property + "(" + adjustment + (unit(unit ? void 0 : 'px')) + ")",
              "-webkit-transform": "" + property + "(" + adjustment + (unit(unit ? void 0 : 'px')) + ")",
              "-ms-transform": "" + property + "(" + adjustment + (unit(unit ? void 0 : 'px')) + ")"
            });
          } else {
            return _this.el.css({
              "transform": adjustment,
              "-moz-transform": adjustment,
              "-webkit-transform": adjustment,
              "-ms-transform": adjustment
            });
          }
        } else {
          return _this.el.css(property, "" + adjustment + "px");
        }
      };
    };

    Prlx.prototype.positionOfElement = function() {
      return (this.el_top - this.scroll_top + this.el_height) / (this.scroll_bottom - this.scroll_top + this.el_height);
    };

    Prlx.prototype.isElFullyVisible = function() {
      var _ref;
      if (((this.scroll_bottom - this.el_height) > (_ref = this.el_top) && _ref > this.scroll_top)) {
        this.el.trigger('prlx:fullyVisible');
        return true;
      }
    };

    Prlx.prototype.isElPartiallyVisible = function() {
      var _ref;
      if ((this.scroll_bottom > (_ref = this.el_top) && _ref > (this.scroll_top - this.el_height))) {
        this.el.trigger('prlx:partiallyVisible');
        return true;
      }
    };

    Prlx.prototype.positionOfPageScrolled = function() {
      return this.scroll_top / (this.document_height - this.window_height);
    };

    Prlx.prototype.isFunction = function(obj) {
      return !!(obj && obj.constructor && obj.call && obj.apply);
    };

    Prlx.prototype.isObject = function(obj) {
      return obj === Object(obj);
    };

    return Prlx;

  })();

  (function($) {
    return $.fn.prlx = function(options, fn) {
      return $.each(this, function() {
        return new Prlx($(this), options);
      });
    };
  })(jQuery);

}).call(this);
